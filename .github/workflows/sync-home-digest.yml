name: Sync Home Digest

on:
workflow_dispatch:
schedule:
# 08:00, 12:00, 20:00 Asia/Shanghai (UTC+8)
- cron: "0 0,4,12 * * *"

jobs:
sync:
runs-on: ubuntu-latest
steps:
- name: Checkout
uses: actions/checkout@v4

- name: Setup Node
uses: actions/setup-node@v4
with:
node-version: 20
cache: npm

- name: Install
run: npm ci

- name: Build digest
run: npm run build:digest
env:
WEBAPP_BASE_URL: ${{ secrets.WEBAPP_BASE_URL }}
- name: Publish digest
run: npm run publish:digest
env:
WEBAPP_BASE_URL: ${{ secrets.WEBAPP_BASE_URL }}
ADMIN_PUBLISH_TOKEN: ${{ secrets.ADMIN_PUBLISH_TOKEN }}
